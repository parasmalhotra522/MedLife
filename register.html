<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="./styles/home-styles.css">
    <link rel="stylesheet" href="./styles/user-profile.css">
   <style>
        .form-container {
            background-color: #fff;
            padding: 2rem;
        }
        .form-heading {
            text-align: center;
            justify-content: center;
            margin:1.2rem;
        }
        .register {
            margin: 2rem;
            margin-top:2rem;
            border: 1px solid #000;
            width: 50%;
            justify-content: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-left: 25%;
            box-shadow: 0 0 1.1rem #bbb;
            background:#fff;
        }
        .register .form-field {
            margin:1.1rem;
        }
        .register .form-field > input {
            width:19rem !important;
            height: 3.2rem;
            padding: 1.2rem;
        } 
        .icon {
            margin:.8rem;
        }
       

        
   </style>
    
</head>
<body>

        <!-- ****---- START OF NAVBAR -----***** -->
     
        <header>
            
            <!--    The Upper Navbar   -->
            <nav class="navbar navbar-expand-lg navbar-light">
               <div class="container-fluid">
                <div class="row">
                    <div class="col-md-2">
                        <a href="./index.html" class="navbar-brand">
                            <img src="./assets/images/logo-image.png" class="logo-image">
                        </a>
                     </div>
    
    
                     <div class="collapse navbar-collapse nav-bar  col-md-10 upper-nav-bar" id="navbarCollapse">
                        <div class="navbar-nav col-md-7">
                            <input type="search"
                             style="width:64rem;"
                            class="form-control nav-item nav-link" placeholder="Search" aria-label="Search" aria-describedby="search-addon">
                        </div>
     
                       
                        
     
                         <!--- ------** User Cart functionality showing the number of items for a user in the cart **-----  -->
                         <div class="navbar-nav col-md-1" style="width: 12.499999995%;flex: 0 0 12.499%;max-width: 12.499%;">
                             <a href="./checkout-form.html" class="nav-item nav-link"
                             id="cart-nav"
                             >
                                 
                                 <i class="fa fa-shopping-cart"></i>
                                 Cart <script>document.getElementById('cart-nav').innerHTML=`
                                 <i class="fa fa-shopping-cart"></i>
                                 Cart
                                 <span  style="border-radius:50%; background-color:#e31b6d;">
                                 
                                 <span class='badge badge-warning' style={
                                     font-size: 12px;
                                     background: #ff0000;
                                     color: #fff;
                                     padding: 0 5px;
                                     vertical-align: top;
                                     margin-left: -10px;
                                 }> 
                                     ${ JSON.parse(localStorage.getItem('activeUser')).userCart.length }
                                      </span>
                                 
                                 `
                             
                                 </script>
                                     
                         </a>
     
                         </div>
                         
                      
                        <div class="navbar-nav col-md-2">
                            <a target="_blank" href="sign-in.html" 
                            id="signInBtn"
                            class="nav-item nav-link">Sign In / Register</a>
                        </div>
                        <!-- User profile button -->
                        <div class="navbar-nav col-md-2 ms-auto"
                        style="position:absolute;
                        left:83%;
                        "
                        >
                       
                           
                            <a target="_blank" 
                            id="userProfile"
                            style="cursor: pointer; font-size: 1.2rem;padding:1.2rem;"
                            class="nav-item nav-link fa fa-user"
                            onclick="toggleMenu()"
                            >
                            </a>
                            
                        </div>
                        
                    </div>
                </div>
               
                   <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
                       <span class="navbar-toggler-icon"></span>
                   </button>
                   
                   
               </div>
             
           </nav>
           <div class="sub-menu-wrap" id="subMenu">
               <div class="sub-menu">
                   <div class="user-info" >
                       <img src="./assets/images/profile.webp" style="height:40px;width:30px;">
                       <h2 id="userNameProfile" style="font-family: inherit; margin-left:.8rem;">
    
                       </h2>
                   </div>
                   <hr>
    
                   <a href="#" class="sub-menu-link">
                      <i class="fa fa-user fa-2x"></i>
                       <p onclick="window.location.href=`./edit-user-profile.html`">Edit Profile ></p>
                       
                   </a>
    
                   <a href="#" class="sub-menu-link">
                       <i class="fa fa-cog fa-2x"></i>
                       <p>Settings & Privacy ></p>
                      
                   </a>
    
                   <a href="#" class="sub-menu-link" onclick="logOut()">
                      <i class="fa fa-sign-out fa-2x"></i>
                       <p>Logout ></p>
                   
                   </a>
               </div>
           </div>
    
       </header>
       <!-- Second-nav-bar-->
       <nav class="navbar navbar-expand-lg navbar-light lower-navbar">
           <div class="container-fluid">
             
               <div class="collapse navbar-collapse nav-bar" id="navbarCollapse">
                   <div class="navbar-nav col-md-1" style="width: 12.499999995%;flex: 0 0 12.499%;max-width: 12.499%;"><a href="./index.html" class="nav-item nav-link active-nav"><i class="fa fa-home icons"></i>Home</a></div>
                   <div class="navbar-nav col-md-1" style="width: 12.499999995%;flex: 0 0 12.499%;max-width: 12.499%;">
                   <a href="./shop.html" class="nav-item nav-link"><i class="fa fa-shopping-basket p-2"></i>Shop</a></div>
                   <div class="navbar-nav col-md-1 col-sm-2" style="width: 12.499999995%;flex: 0 0 12.499%;max-width: 12.499%;"><a href="./about.html" class="nav-item nav-link">About Us</a></div>
                   <div class="navbar-nav col-md-2 col-sm-2" id="pharmacyServices">
                       <a href="#" class="nav-item nav-link"
                       >Pharmacy Services</a></div>
                   <div class="navbar-nav col-md-3 col-sm-3"><a href="./doctor's-prescription.html" class="nav-item nav-link">Doctor's Prescription</a></div>
                   
    
    
               </div>
               
           </div>
       </nav>
        
        <!-- Modal for the medical conditions -->
        <div id="conditions-modal" class="modal">
            <div class="modal-content">
                <span class="close">&times</span>
                
                <div>
                    <h4 class="categories-heading">Categories</h4>
                    <hr>
                    <ul class="medical-categories">
                    
                        <li>
                            <a href="ent.html" class="medical-conditons">ENT (Ear, Nose, Throat)</a>
                        </li>
                        <li>
                            <a href="./eye-care.html" class="medical-conditons">Eye Care</a>
                      
                        </li>
                        <li>
                            <a href="./allergy.html" class="medical-conditons">Allergies</a>
                      
                        </li>
                        <li>
                            <a href="./diabetes.html" class="medical-conditons">Diabetes</a>
                        </li>
                        <li>
                            <a href="./mental-health.html" class="medical-conditons">Mental Health</a>
                        </li>
                    </ul>
                </div>
    
            </div>
        </div>


        <!-- ***-------- END OF NAVBARS --------***-->



        

        <section class="form-container">
           
            <form class="register" id="registerForm">
                <h2 class="form-heading">Register</h2>

                <div class="form-field">
                   
                    <i class="fa fa-user icon"></i>
                    
                    <input type="text" name="name" id="userName" required class="form" placeholder="Name" />
                    <br>
                    
                </div>
                <div><small id="error-user-name"></small></div>
                <div class="form-field">
                    <i class="fa fa-envelope icon"></i>
                    <input type="email" name="mail" id="emailId" required class="form" placeholder="Email" />
                    <br>
                    
                </div>
                <div><small id="error-email"></small></div>



                 <div class="form-field">
                    <i class="fa fa-lock icon"></i>
                    <input type="password" name="pass" id="password" required class="form" placeholder="Enter Password" />
                    <br>       
                </div>
                <div> <small id="error-password"></small></div>

                <div class="form-field">
                    <i class="fa fa-lock icon"></i>
                    <input type="password" name="pass" id="confirmpassword" required class="form" placeholder="Confirm Password" />
                    <br>
                </div>
                <span>
                    <small id="error-confirm-password"></small>
                </span>
                
                <button type="button" 
                    onclick="registerUser()"
                    style="margin:2rem;"
                    disabled
                    id="registerBtn"
                    class=" btn btn-success"
                    
                    >Register
                </button>

         
            </form>

        </section>

        <!-- ***** Back to top Section *****-->

<section style="margin:0;padding:0; background-color:#e31b6d;" 
onclick="backtotop()" 
class="backtotop">
<h2 style="text-align: center;padding:1rem; color:#fff; margin:0;">
    <span class="fa fa-angle-double-up spanarrow">
    </span>
    Back to top
</h2>
</section>

</body>
<!-- ** Footer **  --->
<footer>
    <section class="page-footer">

       
       <div class="quick-links">
            <h2 class="text-center"> Quick Links</h2>
            <ul class="footer-quick-links">
                <li>
                    <a href="./index.html">Home</a>
                </li>

                <li>
                    <a href="./sign-in.html">Sign in</a>
                </li>

                
                <li><a href="./about.html">About Us</a></li>
           
                <li>
                    <a href="./appointment-form.html">Book an Appointment</a>
                </li>
            </ul>
       
       
        </div>
        <!-- Connect with us Section -->
        <div class="quick-links">
            <h2 class="text-center">Connect with Us</h2>
            <ul>
                
                <li>
                    <i class="fa fa-map-marker" 
                    style="color:#FF0000;
                    font-size: 1.5rem;
                    padding: 1.05rem;"></i> 1 Eva Road, M9C 4Z5, Etobicoke, Canada
                  


                </li>
                <li>
                    <i class="fa fa-phone" 
                    style="
                    color:#00BFFF;
                    font-size: 1.5rem;
                    padding: 1.05rem;"></i> +1 (647)-867-4343
                </li>
                
            </ul>

           <div class="contactus">
           
            <li class="list-inline-item">
                <a href="mailto:confusion@food.net" 
                    target="_blank"
                 type="button" class="button fb">
                <span class="fa fa-envelope fa-2x spin"></span>
                </a>
            </li>

            <li class="list-inline-item">
                <a href="https://www.twitter.com/elonmusk" 
                    target="_blank"
                    type="button" class="button fb">
                  <span class="fa fa-twitter fa-2x spin"></span>
                </a>
            </li>
           
          
           <li class="list-inline-item">
            <a href="https://www.facebook.com/" 
                target="_blank"    
                type="button" class="button fb">
              <span class="fa fa-facebook fa-2x spin"></span>
            </a>
          </li>

          <li class="list-inline-item">
            <a href="https://www.instagram.com/" 
                target="_blank"
                type="button" class="button fb">
              <span class="fa fa-instagram fa-2x spin"></span>
            </a>
          </li>
        
        </div>
       
       
        </div>


        <!-- ** GET UPDATES ** -->
        <div class="quick-links">
            <h2 class="text-center"> Get Updates</h2>
            
            <form class="get-updates"> 
                <input type="email" class="form-control" id="inputEmail"
                    style="width:13rem;height:1.8rem;"
                placeholder="name@email.com"
                 data-error="Bruh, that email address is invalid" required>
                  <br>
               
                <div class="submit-btn">
            
                    <button type="submit" 
                        name="submit" 
                        class="form-btn submit-footer">Send Message</button> 
                </div>
            </form>
    
       
       
        </div>

       
       
    </section> 
    <div class="footer-copyright text-center pt-2">
        © All Copyrights are reserved by MedLife Corporations
    </div>
   

</footer>


<script>
     function backtotop() {
        document.body.scrollTop = 0; 
        document.documentElement.scrollTop = 0; 
    }


     // ------ error messages code blocks -------

     const showSuccess = (element,elementId, message) => {
        // console.log("check success" , element, elementId);
        document.getElementById(elementId).innerHTML= '';
        document.getElementById(elementId).classList.remove('error-message');
    }
    const showError=(element,elementId, message) => {
        // console.log(`${element} message ${elementId} ${message}`);
        document.getElementById(elementId).innerHTML= '&#x26A0' + ' ' + message;
        document.getElementById(elementId).classList.add('error-message');
    }
    
    let isRequired = (value) =>  value ? true : false; 
    const isBetween = (length, min, max) => length < min || length > max ? false : true;

    // ------ email checking using regex expression -------
    const isEmailValid = (email) => {
        let reg = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return reg.test(email);
    };

    const isMobileNumberValid = (mobileNo) => {
        let reg = /^\(?(\d{3})\)?[- ]?(\d{3})[- ]?(\d{4})$/
        return reg.test(mobileNo);
    }
  
    const isPasswordValid = (password) => {
        let reg = /^(?=.*[0-9])(?=.*[!@#$%^&*])[a-zA-Z0-9!@#$%^&*]{6,16}$/;
        return reg.test(password);
    }

    const isPasswordSame = (confirmPassword) => {
        // console.log(document.getElementById(password).value);
        return $('password') === confirmPassword;
    }
        // ---- validation for each field ----
    const checkUsername = (userName) => {
            let valid = false;
            const min = 3,max = 25;
            const username = userName.length > 0 ? userName.trim() : null;
            if (!isRequired(username)) {
                showError(userName,'error-user-name', 'Username cannot be blank.');
             } 
             else if (!isBetween(username.length, min, max)) {
                showError(userName, 'error-user-name', `Username must be between ${min} and ${max} characters.`)
            }
             else { 
                showSuccess(username,'error-user-name','' );
                valid = true;
            }
            return valid;
        }
    
    const checkEmailValidation = (emailId) => {      
            let valid = false;
            // console.log("Check email", emailId, typeof(emailId));
            if (!isRequired(emailId)) {
                showError(emailId, 'error-email', 'Email Id cannot be blank.');
             } 
             else if (!isEmailValid(emailId)) {
                showError(emailId, 'error-email', 'Email Id is not valid');
            }
             else { 
                showSuccess(emailId,'error-email');
                valid = true;
            }
            return valid;
    }
    const checkPassword = (password) => {
        let valid = false;
        if (!isRequired(password)) {
                showError(password, 'error-password', 'Password cannot be blank.');
             } else if(!isPasswordValid(password)) {
                showError(password, 'error-password', 'Password should be between (Should contain atleast 1 number & 1 special character )');
             }
             else { 
                showSuccess(password,'error-password');
                valid = true;
            }
            return valid;
    }

    const reconfirmPassword = (confirmpassword) => {
        let valid = false;
        if (!isRequired(confirmpassword)) {
                showError(confirmpassword, 'error-confirm-password', 'Confirm Password is Mandatory.');
            } 
            else if(!isPasswordSame(confirmpassword)) {
                showError(confirmpassword, 'error-confirm-password', 'Password and Confirm Password should be same');
            
            }
            else { 
                showSuccess(confirmpassword,'error-confirm-password');
                valid = true;
            }
            return valid;

    }
    
   const $ = (id) => document.getElementById(id).value;
   
   document.querySelector('#userName').addEventListener('input', () => checkUsername($('userName')));
   document.querySelector('#emailId').addEventListener('input',()=>checkEmailValidation($('emailId')));
   document.querySelector('#password').addEventListener('input',()=>checkPassword($('password')));
   document.querySelector('#confirmpassword').addEventListener('input',()=>reconfirmPassword($('confirmpassword')));
    

   if (checkUsername && checkEmailValidation && checkPassword && reconfirmPassword) {
    document.getElementById('registerBtn').disabled = false;
   } else {
    document.getElementById('registerBtn').disabled = true;
  
   }
    
   window.onload = ()  => console.log(JSON.parse(localStorage.getItem('users')));
   function registerUser() {
    console.log(`User Name : ${$('userName')}\n 
    emailId : ${$('emailId')} \n 
    password : ${$('password')}\n
    `);

    console.log('Existing Users',localStorage.getItem('users'));
    let existingUsers = JSON.parse(localStorage.getItem('users'));
    // console.log(existingUsers);
    let flag=false;
    existingUsers.forEach((user) => {
        
        // user doesn't exist already
        if ($('userName') === user.userName && $('emailId') === user.emailId) {
           
            alert(`
                User with same Email Id / UserName already exists
            `);
            document.getElementById('registerForm').reset();

                       
        } else {
         flag = true;
        } 

    });
    if (flag) {
        existingUsers.push({
                'userName' : $('userName'),
                'emailId' : $('emailId'),
                'userPassword' : $('password'),
                'isLoggedIn' : false,
                'isAdmin' : false,
                'userCart' : [],
                'savedAddress' : []
            });
            alert(`User : ${$('userName')} registered successfully`);

            localStorage.setItem('activeUser', null);
            localStorage.setItem('users', JSON.stringify(existingUsers));
            // after successfully registeration reload user to login page
            window.location.href="./sign-in.html";

    }
    console.log("After registering ..." , existingUsers);



   }    

</script>
    
</body>
</html>