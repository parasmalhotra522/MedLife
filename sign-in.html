<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign in</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	
    <link rel="stylesheet" href="./styles/home-styles.css">
    <link rel="stylesheet" href="./styles/sign-in.css">
  
     
    <script type="text/javascript" src="./scripts/login.js"></script>

    <script  src="https://smtpjs.com/v3/smtp.js"></script>

</head>
    <body>

        <!-- ****---- START OF NAVBAR -----***** -->
     
        <header>
            
            <!--    The Upper Navbar   -->
            <nav class="navbar navbar-expand-lg navbar-light">
               <div class="container-fluid">
                <div class="row">
                    <div class="col-md-2">
                        <a href="./index.html" class="navbar-brand">
                            <img src="./assets/images/logo-image.png" class="logo-image">
                        </a>
                     </div>
    
    
                     <div class="collapse navbar-collapse nav-bar  col-md-10 upper-nav-bar" id="navbarCollapse">
                        <div class="navbar-nav col-md-7">
                            <input type="search"
                             style="width:64rem;"
                            class="form-control nav-item nav-link" placeholder="Search" aria-label="Search" aria-describedby="search-addon">
                        </div>
     
                       
                        
     
                         <!--- ------** User Cart functionality showing the number of items for a user in the cart **-----  -->
                         <div class="navbar-nav col-md-1" style="width: 12.499999995%;flex: 0 0 12.499%;max-width: 12.499%;">
                             <a href="./checkout-form.html" class="nav-item nav-link"
                             id="cart-nav"
                             >
                                 
                                 <i class="fa fa-shopping-cart"></i>
                                 Cart <script>document.getElementById('cart-nav').innerHTML=`
                                 <i class="fa fa-shopping-cart"></i>
                                 Cart
                                 <span  style="border-radius:50%; background-color:#e31b6d;">
                                 
                                 <span class='badge badge-warning' style={
                                     font-size: 12px;
                                     background: #ff0000;
                                     color: #fff;
                                     padding: 0 5px;
                                     vertical-align: top;
                                     margin-left: -10px;
                                 }> 
                                     ${ JSON.parse(localStorage.getItem('activeUser')).userCart.length }
                                      </span>
                                 
                                 `
                             
                                 </script>
                                     
                         </a>
     
                         </div>
                         
                      
                        <div class="navbar-nav col-md-2">
                            <a target="_blank" href="sign-in.html" 
                            id="signInBtn"
                            class="nav-item nav-link">Sign In / Register</a>
                        </div>
                        <!-- User profile button -->
                        <div class="navbar-nav col-md-2 ms-auto"
                        style="position:absolute;
                        left:83%;
                        "
                        >
                       
                           
                            <a target="_blank" 
                            id="userProfile"
                            style="cursor: pointer; font-size: 1.2rem;padding:1.2rem;"
                            class="nav-item nav-link fa fa-user"
                            onclick="toggleMenu()"
                            >
                            </a>
                            
                        </div>
                        
                    </div>
                </div>
               
                   <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
                       <span class="navbar-toggler-icon"></span>
                   </button>
                   
                   
               </div>
             
           </nav>
           <div class="sub-menu-wrap" id="subMenu">
               <div class="sub-menu">
                   <div class="user-info" >
                       <img src="./assets/images/profile.webp" style="height:40px;width:30px;">
                       <h2 id="userNameProfile" style="font-family: inherit; margin-left:.8rem;">
    
                       </h2>
                   </div>
                   <hr>
    
                   <a href="#" class="sub-menu-link">
                      <i class="fa fa-user fa-2x"></i>
                       <p onclick="window.location.href=`./edit-user-profile.html`">Edit Profile ></p>
                       
                   </a>
    
                   <a href="#" class="sub-menu-link">
                       <i class="fa fa-cog fa-2x"></i>
                       <p>Settings & Privacy ></p>
                      
                   </a>
    
                   <a href="#" class="sub-menu-link" onclick="logOut()">
                      <i class="fa fa-sign-out fa-2x"></i>
                       <p>Logout ></p>
                   
                   </a>
               </div>
           </div>
    
       </header>
       <!-- Second-nav-bar-->
       <nav class="navbar navbar-expand-lg navbar-light lower-navbar">
           <div class="container-fluid">
             
               <div class="collapse navbar-collapse nav-bar" id="navbarCollapse">
                   <div class="navbar-nav col-md-1" style="width: 12.499999995%;flex: 0 0 12.499%;max-width: 12.499%;"><a href="./index.html" class="nav-item nav-link active-nav"><i class="fa fa-home icons"></i>Home</a></div>
                   <div class="navbar-nav col-md-1" style="width: 12.499999995%;flex: 0 0 12.499%;max-width: 12.499%;">
                   <a href="./shop.html" class="nav-item nav-link"><i class="fa fa-shopping-basket p-2"></i>Shop</a></div>
                   <div class="navbar-nav col-md-1 col-sm-2" style="width: 12.499999995%;flex: 0 0 12.499%;max-width: 12.499%;"><a href="./about.html" class="nav-item nav-link">About Us</a></div>
                   <div class="navbar-nav col-md-2 col-sm-2" id="pharmacyServices">
                       <a href="#" class="nav-item nav-link"
                       >Pharmacy Services</a></div>
                   <div class="navbar-nav col-md-3 col-sm-3"><a href="./doctor's-prescription.html" class="nav-item nav-link">Doctor's Prescription</a></div>
                   
    
    
               </div>
               
           </div>
       </nav>
        
        <!-- Modal for the medical conditions -->
        <div id="conditions-modal" class="modal">
            <div class="modal-content">
                <span class="close">&times</span>
                
                <div>
                    <h4 class="categories-heading">Categories</h4>
                    <hr>
                    <ul class="medical-categories">
                    
                        <li>
                            <a href="ent.html" class="medical-conditons">ENT (Ear, Nose, Throat)</a>
                        </li>
                        <li>
                            <a href="./eye-care.html" class="medical-conditons">Eye Care</a>
                      
                        </li>
                        <li>
                            <a href="./allergy.html" class="medical-conditons">Allergies</a>
                      
                        </li>
                        <li>
                            <a href="./diabetes.html" class="medical-conditons">Diabetes</a>
                        </li>
                        <li>
                            <a href="./mental-health.html" class="medical-conditons">Mental Health</a>
                        </li>
                    </ul>
                </div>
    
            </div>
        </div>



        <!-- ***-------- END OF NAVBARS --------***-->

        <!----- ***----- SIGN-IN FORM --------***-->
         <section class="sign-in-form-container" id="sign-in-form">
           
            <form class="sign-register">
                <h2 class="form-heading">Sign In / Register</h2>



                <div class="form-control fields" >
                    <label for="email">Email <span style="color:#FF0000;">*</span></label>

                    <input type="email" name="email" id="userEmailId"
                    placeholder="Enter mobile number / email">
                </div>

                <div class="form-control fields">
                    <label for="password">Password <span style="color:#FF0000;">*</span></label>
                   <input type="password" name="password" 
                    id="userPassword"
                    placeholder="Enter password">
                </div>
                
                <button type="button" 
                    onclick="signIn()"
                    class="btn btn-submit">Sign In
                </button>

                <p class="form-control text-center" style="font-weight:bold;">OR</p>

                <a href="./register.html" style="margin:2rem;">Not a Member ? Click to Register</a>
               <!--
                <div class="social-icons">
                    <br>
                    <div class="pop-out">
                        <a class="btn btn-outline-dark" href="/users/googleauth" role="button" style="text-transform:none">
                            <img width="20px" style="margin-bottom:3px; margin-right:5px" alt="Google sign-in" 
                            src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/53/Google_%22G%22_Logo.svg/512px-Google_%22G%22_Logo.svg.png" />
                            Login with Google
                        </a>
                    </div>

                    <div class="pop-out" style="margin-top:3rem;">
                        <a class="btn fb-btn" href="/users/googleauth" 
                            role="button" style="text-transform:none"
                            style="background-color: #4C69BA;
                            background-image: linear-gradient(#4C69BA, #3B55A0)"
                            >


                           <i class="fa fa-facebook"></i>
                            Login with facebook
                        </a>
                    </div>


                </div>
                -->
            </form>

        </section>

        <section id="alreadyLogged" style="margin:4rem;">
            <h1 class="text-center" > User is already logged In</h1>
        </section>
        <footer>
            <section class="page-footer">
        
               
               <div class="quick-links">
                    <h2 class="text-center"> Quick Links</h2>
                    <ul class="footer-quick-links">
                        <li>
                            <a href="./index.html">Home</a>
                        </li>
        
                        <li>
                            <a href="./sign-in.html">Sign in</a>
                        </li>
        
                        
                        <li><a href="./about.html">About Us</a></li>
                   
                        <li>
                            <a href="./appointment-form.html">Book an Appointment</a>
                        </li>
                    </ul>
               
               
                </div>
                <!-- Connect with us Section -->
                <div class="quick-links">
                    <h2 class="text-center">Connect with Us</h2>
                    <ul>
                        
                        <li>
                            <i class="fa fa-map-marker" 
                            style="color:#FF0000;
                            font-size: 1.5rem;
                            padding: 1.05rem;"></i> 1 Eva Road, M9C 4Z5, Etobicoke, Canada 
                          
        
        
                        </li>
                        <li>
                            <i class="fa fa-phone" 
                            style="
                            color:#00BFFF;
                            font-size: 1.5rem;
                            padding: 1.05rem;"></i> +1 (647)-867-4343
                        </li>
                        
                    </ul>
        
                   <div class="contactus">
                   
                    <li class="list-inline-item">
                        <a href="mailto:confusion@food.net" 
                            target="_blank"
                         type="button" class="button fb">
                        <span class="fa fa-envelope fa-2x spin"></span>
                        </a>
                    </li>
        
                    <li class="list-inline-item">
                        <a href="https://www.twitter.com/elonmusk" 
                            target="_blank"
                            type="button" class="button fb">
                          <span class="fa fa-twitter fa-2x spin"></span>
                        </a>
                    </li>
                   
                  
                   <li class="list-inline-item">
                    <a href="https://www.facebook.com/" 
                        target="_blank"    
                        type="button" class="button fb">
                      <span class="fa fa-facebook fa-2x spin"></span>
                    </a>
                  </li>
        
                  <li class="list-inline-item">
                    <a href="https://www.instagram.com/" 
                        target="_blank"
                        type="button" class="button fb">
                      <span class="fa fa-instagram fa-2x spin"></span>
                    </a>
                  </li>
                
                </div>
               
               
                </div>
        
        
                <!-- ** GET UPDATES ** -->
                <div class="quick-links">
                    <h2 class="text-center"> Get Updates</h2>
                    
                    <form class="get-updates"> 
                        <input type="email" class="form-control" id="inputEmail"
                            style="width:13rem;height:1.8rem;"
                        placeholder="name@email.com"
                         data-error="Bruh, that email address is invalid" required>
                          <br>
                       
                        <div class="submit-btn">
                    
                            <button type="submit" 
                                name="submit" 
                                class="form-btn submit-footer">Send Message</button> 
                        </div>
                    </form>
            
               
               
                </div>
        
               
               
            </section> 
            <div class="footer-copyright text-center pt-2">
                Â© All Copyrights are reserved by MedLife Corporations
            </div>
           
        
        </footer>
        

        <script>

            //------------- All login/logout functionality  --------
            
            // fetching and parsing the user data from the local storage 
            allUsers = JSON.parse(localStorage.getItem('users'));
            console.log("all users", allUsers);

            // functon to be executed to check if the user is already signed in...
            window.onload = function() {
                activeUser = JSON.parse(localStorage.getItem('activeUser'));
                console.log("Check active user", activeUser);
               document.getElementById('userProfile').hidden = true;
               document.getElementById("alreadyLogged").hidden = true;
                    
                
                // it means user is logged in
                // we have to hide the 
                if(activeUser) {
                    document.getElementById('signInBtn').hidden = true;
                    document.getElementById('userProfile').hidden = false;
                    document.getElementById('userProfile').innerHTML=activeUser.userName;
                    document.getElementById('userNameProfile').innerHTML=activeUser.userName;
                    
                     // hide the sign-in form if user is already logged in
                    document.getElementById("sign-in-form").hidden = true;
                    document.getElementById("alreadyLogged").hidden = false;
                        
                    }
            }

           
            let subMenu = document.getElementById("subMenu");
            function toggleMenu() {
                console.log("toggle ");
                subMenu.classList.toggle("open-menu");
                document.querySelector("sub-menu-wrap").classList.add('display:inline');

            }


            // function called on clicking signIn() button which will filter the particular user
            // credentials from the ones already setup ... in the localstorage..
            function signIn() {
            let userEmailId = document.getElementById('userEmailId').value;
                let password = document.getElementById('userPassword').value;
                
                // console.log(`User entered emailId : ${userEmailId}\nPassword : ${password}`);
               
                // extracting the only user with the given credentials
                let filteredUser = (allUsers.filter((user) => user.emailId === userEmailId)[0]);
                
                if (filteredUser?.emailId === userEmailId &&
                    filteredUser?.userPassword === password
                    ) {
                        
                        filteredUser.isLoggedIn = true;
                        // set an active user to the signed-in user
                        localStorage.setItem("activeUser", JSON.stringify(filteredUser));
                        localStorage.setItem("users", JSON.stringify(allUsers));
                        
                        // route to shop page if the user credential validation is successfull
                        window.location.href="./shop.html";

                    } else {
                        alert(`Invalid Credentials !! Please retry using some other credentials`);
                    }
                };
            

            // function to logout and clear the local storage for any kind of data stored and route back to home
            function logOut() {
                console.log("Function getting called");
                // changing the flag value of the boolean to false; for the active user
                localStorage.setItem('activeUser', JSON.stringify(JSON.parse(localStorage.getItem("activeUser")).isLoggedIn = false));
                // localStorage.clear();
                // localStorage.setItem('users') = 
                // JSON.stringify(JSON.parse(localStorage.getItem('users')));
                // localStorage.setItem('activeUser', null);
                window.location.href="./index.html";
                
            }





        </script>

    </body>

 
</html>